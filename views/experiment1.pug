doctype html
html
  head
    title= 'experiment 1'
    link(rel='stylesheet', href='/stylesheets/style.css')
  body(class='exp')
    script(src='http://d3js.org/d3.v3.min.js', charset='utf-8')
    script(src='/scripts/dragula.min.js', type='text/javascript')
    script.
      let data = !{JSON.stringify(data)}
      var max = data.length
    - var count = 0
    h1 Please sort the items below to a list with higher taste score on the left and higher health score on the right.
    form(id='sortingResult', name='sortingResult', action='/experiment1/'+ trial + '/' + userId, method='post', onsubmit="div2form('sortingResult')")
      div#destinationPanel
        input(type='hidden', name='trial', value=trial)
        input(type='hidden', name='userId', value=userId)
        input(type='hidden', name='startingTime', value=startingTime)
      table.lower
        tr
          td
            table.sort
              tr
                th Sort by
              tr
                td
                  button(class='sort') Alphabet
              tr
                td
                  button(class='sort') Taste
              tr
                td
                  button(class='sort') Health
          td
            div#sourcePanel
              - var count = 0
              each item in data
                - var foodName = item.foodname
                - var taste = item.taste
                - var health = item.health
                - var imgPath = item.path
                div.card(id= 'food'+count, name='card')
                  h3 #{foodName}
                  if foodName.length < 24
                    br
                  div(style="visibility: hidden; font-size: 0pt")
                    p(name='foodId') #{item.id}
                  img(src= imgPath alt= foodName)
                  table.scores
                    tr
                      th.taste Taste
                      th.health Health
                    tr
                      td.taste(name='taste') #{taste}
                      td.health(name='health') #{health}
          td
            table.option
              tr
                td
                  button(class='expSubmit', type='submit', value='submit') I'm done!
              tr
                td
                  button(class='resetSort') Reset Sort
          
    script.
      var get = function(id){ return document.getElementById(id)}
      dragula([get('sourcePanel'), get('destinationPanel')], {})
      function div2form(id) {
        var form = get(id)
        if (!form) { return }
        var divs = form.getElementsByTagName('div')
        var ndivs = (divs.length - 1) / 2
        var texta = document.createElement('TEXTAREA')
        texta.name = 'sorts'
        texta.style.display = 'none'
        temp = []
        for (var i = 0; i < ndivs; i++) {
          var obj = {
            ordering: i,
            foodName: divs[0].getElementsByTagName('h3')[i].innerHTML,
            foodId: divs[0].getElementsByTagName('p')[i].innerHTML,
            taste: divs[0].getElementsByTagName('td')[2 * i].innerHTML,
            health: divs[0].getElementsByTagName('td')[2 * i + 1].innerHTML
          }
          var str = JSON.stringify(obj)
          temp.push(str)
        }
        texta.value = temp
        form.appendChild(texta)
      }
    